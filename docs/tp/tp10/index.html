<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Séance 10 #  Exercice 1 #  declare P S {NewPort S P} proc {BrowseStream S} proc {BrowseStreamH S} case S of H|T then {Browse H} {BrowseStreamH T} end end in thread {BrowseStreamH S} end end {BrowseStream S} {Send P foo} {Send P bar} Exercice 2 #  declare fun {LaunchServer} P S proc {HandleStream S} case S of H|T then case H of add(X Y R) then R = X+Y {HandleStream T} [] pow(X Y R) then R={Number."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Séance 10"><meta property="og:description" content="Séance 10 #  Exercice 1 #  declare P S {NewPort S P} proc {BrowseStream S} proc {BrowseStreamH S} case S of H|T then {Browse H} {BrowseStreamH T} end end in thread {BrowseStreamH S} end end {BrowseStream S} {Send P foo} {Send P bar} Exercice 2 #  declare fun {LaunchServer} P S proc {HandleStream S} case S of H|T then case H of add(X Y R) then R = X+Y {HandleStream T} [] pow(X Y R) then R={Number."><meta property="og:type" content="article"><meta property="og:url" content="https://ahzed11.github.io/guide-oz/docs/tp/tp10/"><meta property="article:section" content="docs"><meta property="article:published_time" content="2022-04-19T15:32:27+02:00"><meta property="article:modified_time" content="2022-04-19T15:32:27+02:00"><meta property="og:site_name" content="Guide OZ"><title>Séance 10 | Guide OZ</title><link rel=manifest href=/guide-oz/manifest.json><link rel=icon href=/guide-oz/favicon.png type=image/x-icon><link rel=stylesheet href=/guide-oz/book.min.87312a22c120b2e99e4dbec51f671dd6b1cb0bed3b12a909c39a0aa981eb5a8f.css integrity="sha256-hzEqIsEgsumeTb7FH2cd1rHLC+07EqkJw5oKqYHrWo8=" crossorigin=anonymous><script defer src=/guide-oz/flexsearch.min.js></script>
<script defer src=/guide-oz/en.search.min.81e2baa214ef28e1f345db2996c466317ab22bfddf3cf1e195d3717f67b7e7f7.js integrity="sha256-geK6ohTvKOHzRdsplsRmMXqyK/3fPPHhldNxf2e35/c=" crossorigin=anonymous></script>
<link rel=stylesheet href=https://ahzed11.github.io/guide-oz/css/prism.css><script type=text/javascript src=https://ahzed11.github.io/guide-oz/js/prism.js></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/guide-oz/><span>Guide OZ</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://ahzed11.github.io/guide-oz/docs/installation/>Installation de Mozart2</a><ul><li><a href=https://ahzed11.github.io/guide-oz/docs/installation/vscode/>VSCode</a></li><li><a href=https://ahzed11.github.io/guide-oz/docs/installation/windows/>Windows</a></li><li><a href=https://ahzed11.github.io/guide-oz/docs/installation/macos/>Macos</a></li><li><a href=https://ahzed11.github.io/guide-oz/docs/installation/linux/>Linux</a></li></ul></li><li><a href=https://ahzed11.github.io/guide-oz/docs/tp/>TP</a><ul><li><a href=https://ahzed11.github.io/guide-oz/docs/tp/tp1/>Séance 1</a></li><li><a href=https://ahzed11.github.io/guide-oz/docs/tp/tp2/>Séance 2</a></li><li><a href=https://ahzed11.github.io/guide-oz/docs/tp/tp3/>Séance 3</a></li><li><a href=https://ahzed11.github.io/guide-oz/docs/tp/tp4/>Séance 4</a></li><li><a href=https://ahzed11.github.io/guide-oz/docs/tp/tp5/>Séance 5</a></li><li><a href=https://ahzed11.github.io/guide-oz/docs/tp/tp6/>Séance 6</a></li><li><a href=https://ahzed11.github.io/guide-oz/docs/tp/tp8/>Séance 8</a></li><li><a href=https://ahzed11.github.io/guide-oz/docs/tp/tp9/>Séance 9</a></li><li><a href=https://ahzed11.github.io/guide-oz/docs/tp/tp10/ class=active>Séance 10</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/guide-oz/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Séance 10</strong>
<label for=toc-control><img src=/guide-oz/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#exercice-1>Exercice 1</a></li><li><a href=#exercice-2>Exercice 2</a></li><li><a href=#exercice-3>Exercice 3</a></li><li><a href=#exercice-4>Exercice 4</a></li><li><a href=#exercice-5>Exercice 5</a></li><li><a href=#exercice-6>Exercice 6</a></li><li><a href=#exercice-7>Exercice 7</a></li></ul></nav></aside></header><article class=markdown><h1 id=séance-10>Séance 10
<a class=anchor href=#s%c3%a9ance-10>#</a></h1><h2 id=exercice-1>Exercice 1
<a class=anchor href=#exercice-1>#</a></h2><pre tabindex=0><code class=language-oz data-lang=oz>declare
P S
{NewPort S P}

proc {BrowseStream S}
    proc {BrowseStreamH S}
        case S of H|T then {Browse H} {BrowseStreamH T} end
    end
in
    thread {BrowseStreamH S} end
end

{BrowseStream S}

{Send P foo}
{Send P bar}
</code></pre><h2 id=exercice-2>Exercice 2
<a class=anchor href=#exercice-2>#</a></h2><pre tabindex=0><code class=language-oz data-lang=oz>declare
fun {LaunchServer}
    P S
    proc {HandleStream S}
        case S of H|T then
            case H of add(X Y R) then
                R = X+Y
                {HandleStream T}
            [] pow(X Y R) then
                R={Number.pow X Y}
                {HandleStream T}
            [] &#39;div&#39;(X Y R) then
                R = X div Y
                {HandleStream T}
            else
                {Browse &#34;je ne comprends pas ton message&#34;}
                {HandleStream T}
            end 
        end
    end
in
    {NewPort S P}
    thread {HandleStream S} end
    P
end
A = {LaunchServer}
R S T
{Send A pow(10 2 R)}
{Send A add(12 18 S)}
{Send A &#39;div&#39;(12 2 T)}
{Browse R}
{Browse S}
{Browse T}
</code></pre><h2 id=exercice-3>Exercice 3
<a class=anchor href=#exercice-3>#</a></h2><pre tabindex=0><code class=language-oz data-lang=oz>declare
fun {StudentRMI}
    S
in
    thread
        for ask(howmany:Beers) in S do
            Beers={OS.rand} mod 24
        end
    end
    {NewPort S}
end
 
fun {StudentCallBack}
    S
in
    thread
        for ask(howmany:P) in S do
            {Send P {OS.rand} mod 24}
        end
    end
    {NewPort S}
end
 
fun {CreateUniversity Size F}
    fun {CreateLoop I}
        if I =&lt; Size then
 % pour {Student} choisissez soit StudentRMI ou StudentCallBack,
 % défini plus haut, selon l&#39;humeur de Charlotte
            {F}|{CreateLoop I+1}
        else nil end
    end
in
    {CreateLoop 1}
end
 
 
fun {Charlotte UniStr Type} 
    CharlotteStream
    CharlottePort = {NewPort CharlotteStream} 
 
    fun {TotalCallBack UnivStr NumberStr Acc}
        N
    in 
        case UnivStr of Stud1|Studs then 
            {Send Stud1 ask(howmany:CharlottePort)} 
            case NumberStr of Num1|Nums then
                N=Num1
                {TotalCallBack Studs Nums N+Acc} 
            else
                N = 0
                {TotalCallBack Studs nil N+Acc} 
            end 
        else Acc end 
    end
    
    fun {TotalRMI UnivStr Acc} 
        case UnivStr of Stud1|Studs then 
            N
        in 
            {Send Stud1 ask(howmany:N)} 
            {TotalRMI Studs Acc+N} 
        else Acc end 
    end 
in 
    case Type of rmi then 
        {TotalRMI UniStr 0} 
    else 
        {TotalCallBack UniStr CharlotteStream 0} 
    end
end

Uni = {CreateUniversity 10 StudentCallBack}
UniRMI = {CreateUniversity 10 StudentRMI}
Total = {Charlotte Uni student}
TotalRmi = {Charlotte UniRMI rmi}
{Browse Total}
{Browse TotalRmi}
</code></pre><h2 id=exercice-4>Exercice 4
<a class=anchor href=#exercice-4>#</a></h2><pre tabindex=0><code class=language-oz data-lang=oz>declare

fun {NewPortObject Behaviour Init}
    proc {MsgLoop S1 State}
        case S1 of Msg|S2 then
            {MsgLoop S2 {Behaviour Msg State}}
        [] nil then skip
    end
end
    Sin
in
    thread {MsgLoop Sin Init} end
    {NewPort Sin}
end

fun {Portier}
    fun {Counter Msg State}
        case Msg of getIn(N) then
            State + N
        [] getOut(N) then
            State - N
        [] getCount(N) then
            N = State
            State
        else
            State
        end
    end
in
    {NewPortObject Counter 0}
end

O = {Portier}
{Send O getIn(10)}
{Send O getOut(2)}
X
{Send O getCount(X)}
{Browse X}
</code></pre><h2 id=exercice-5>Exercice 5
<a class=anchor href=#exercice-5>#</a></h2><pre tabindex=0><code class=language-oz data-lang=oz>declare
fun {NewPortObject Behaviour Init}
    proc {MsgLoop S1 State}
        case S1 of Msg|S2 then
            {MsgLoop S2 {Behaviour Msg State}}
        [] nil then skip
    end
end
    Sin
in
    thread {MsgLoop Sin Init} end
    {NewPort Sin}
end

fun {NewStack}
    fun {Stack Msg State}
        case Msg of push(N) then
            N|State
        [] pop(N) then
            case State of nil then N=nil nil
            [] H|T then
                N=H
                T
            end
        [] isEmpty(N) then
            N = State == nil
            State
        else
            State
        end
    end
in
    {NewPortObject Stack nil}
end

proc {Push P X}
    {Send P push(X)}
end

proc {Pop P X}
    {Send P pop(X)}
end

proc {IsEmpty P X}
    {Send P isEmpty(X)}
end

Stack = {NewStack}
{Push Stack 1}
{Push Stack 2}
{Push Stack 3}
F = {IsEmpty Stack}
A = {Pop Stack}
B = {Pop Stack}
C = {Pop Stack}
T = {IsEmpty Stack}

{Browse F}
{Browse A}
{Browse B}
{Browse C}
{Browse T}
</code></pre><h2 id=exercice-6>Exercice 6
<a class=anchor href=#exercice-6>#</a></h2><pre tabindex=0><code class=language-oz data-lang=oz>declare
fun {NewPortObject Behaviour Init}
    proc {MsgLoop S1 State}
        case S1 of Msg|S2 then
            {MsgLoop S2 {Behaviour Msg State}}
        [] nil then skip
    end
end
    Sin
in
    thread {MsgLoop Sin Init} end
    {NewPort Sin}
end

fun {NewQueue}
    fun {Queue Msg State}
        case Msg of enqueue(N) then
            N|State
        [] dequeue(N) then
            case State 
            of nil then
                N = nil
                nil 
            [] _|_ then
                Reversed
            in
                Reversed = {List.reverse State}
                N = Reversed.1
                {List.reverse Reversed.2}
            end 
        [] isEmpty(N) then
            N = State == nil
            State
        [] getElements(N) then
            N = State
            State
        else
            State
        end
    end
in
    {NewPortObject Queue nil}
end

proc {Enqueue P X}
    {Send P enqueue(X)}
end

proc {Dequeue P X}
    {Send P dequeue(X)}
end

proc {IsEmpty P X}
    {Send P isEmpty(X)}
end

proc {GetElements P X}
    {Send P getElements(X)}
end

Queue = {NewQueue}
{Enqueue Queue 1}
{Enqueue Queue 2}
{Enqueue Queue 3}
E = {GetElements Queue}
F = {IsEmpty Queue}
A = {Dequeue Queue}
B = {Dequeue Queue}
C = {Dequeue Queue}
T = {IsEmpty Queue}

{Browse E}
{Browse F}
{Browse A}
{Browse B}
{Browse C}
{Browse T}
</code></pre><h2 id=exercice-7>Exercice 7
<a class=anchor href=#exercice-7>#</a></h2></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#exercice-1>Exercice 1</a></li><li><a href=#exercice-2>Exercice 2</a></li><li><a href=#exercice-3>Exercice 3</a></li><li><a href=#exercice-4>Exercice 4</a></li><li><a href=#exercice-5>Exercice 5</a></li><li><a href=#exercice-6>Exercice 6</a></li><li><a href=#exercice-7>Exercice 7</a></li></ul></nav></div></aside></main></body></html>